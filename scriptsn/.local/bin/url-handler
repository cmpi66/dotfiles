#!/bin/sh

urlregex="(((http|https|gopher|gemini|ftp|ftps|git)://|www\\.)[a-zA-Z0-9.]*[:;a-zA-Z0-9./+@$&%?$\#=_~-]*)|((magnet:\\?xt=urn:btih:)[a-zA-Z0-9]*)"

urls="$(
  grep -aEo "$urlregex" |
    sed 's/\(\.\|,\|;\|\!\\|\?\)$//' |
    sed 's/^www./http:\/\/www\./' |
    sort -u
)"

[ -z "$urls" ] && exit 1

while getopts "hoc" o; do
  case "${o}" in
  o)
    chosen="$(printf "%s\n" "$urls" | rofi -dmenu -i -p 'Follow which url?' -l 10)"
    [ -n "$chosen" ] && setsid xdg-open "$chosen" >/dev/null 2>&1 &
    ;;
  c)
    printf "%s\n" "$urls" | rofi -dmenu -i -p 'Copy which url?' -l 10 |
      tr -d '\n' | wl-copy
    ;;
  *)
    exit 1
    ;;
  esac
done
